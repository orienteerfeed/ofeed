import{m as ue,r as p,c as _,n as ee,d as j,o as h,a as T,b as o,t as G,u as s,g as X,w as te,i as fe,p as pe,s as be,q as ye,x as ve,y as he,z as _e,e as xe,A as re,B as Ce,C as ke,l as J,h as ce,F as Y,f as Z,_ as ie,j as F,D as q,E as we,G as Q,H as ae,I as Se}from"./index-886848bc.js";import{u as Ie,b as Te,c as Re,d as De,a as Be,_ as Ve}from"./useDataProvider-386edcea.js";const W=ue("settings",()=>{const f=p(!1);function t(l){typeof l>"u"?f.value=!f.value:f.value=l}const i=p(!0),n=p(!0),e=p("page"),a=p(1);function g(l){a.value=l,A()}const b=p(.5),k=_(()=>b.value*1e3);function R(l){e.value=l}const V=p(!0),x=p([]),w=p([]),M=l=>{!l.length||JSON.stringify(l)===JSON.stringify(x.value)||(x.value=l,w.value=l.map(d))},D=_(()=>w.value.sort((l,m)=>l.order-m.order)),B=_(()=>D.value.filter(l=>l.selected)),L=p([]),c=l=>Array.from({length:l},()=>[]);ee([B,a],r,{immediate:!0});function r(){L.value=B.value.reduce((l,m)=>(l[m.column-1].push(m),l),c(a.value))}function d(l,m){return{name:l,selected:!0,column:1,order:m}}function y(l,m){const S=m??!l.selected;l.selected=S,a.value===1?l.column=S?1:null:A()}function C(l,m){l.selected&&(m>a.value||(l.column=m,r()))}function $(l,m){const S=l.order,U=m?S-1:S+1,K=D.value[U];K.order=S,l.order=U}function A(){const l=Me(B.value,a.value);for(let m=0;m<l.length;m++)for(const S of l[m])S.column=m+1;r()}return{areSettingsDisplayed:f,setSettingsDisplayed:t,compactMode:i,showEmojis:n,scrollType:e,setScrollType:R,scrollColumnsCount:a,setScrollColumnsCount:g,readLineTimeSeconds:b,readLineTimeMS:k,showUnfinishedAthletes:V,availableCategories:x,categoriesDisplayRaw:w,categoriesDisplay:D,categoriesDisplayByColumn:L,setAvailableCategories:M,setCategoryDisplayColumn:C,setCategoryDisplayOrder:$,setCategorySelected:y}},{persist:!0});function Me(f,t){const i=[],n=[...f],e=Math.round(f.length/t);for(let a=t;a>1;a--)i.push(n.splice(0,e));return i.push(n),i}const Ae={class:"tabular-nums"},Fe=o("span",null,null,-1),Le={class:"absolute right-3 z-2 bg-header"},Pe=j({__name:"CompetitionHeader",props:{competition:null},setup(f){const t=f,i=W(),{nowFormatted:n}=Ie(),e=p(!1);return(a,g)=>{const b=pe("RouterLink");return h(),T("h1",{class:"flex justify-between gap-2.5 bg-header font-mrb font-bold text-4xl text-white p-3",onMouseenter:g[1]||(g[1]=k=>e.value=!0),onMouseleave:g[2]||(g[2]=k=>e.value=!1)},[o("span",Ae,G(s(n)),1),o("span",null,G(t.competition.name),1),Fe,o("div",Le,[X(b,{"data-testid":"home-button",to:"/"},{default:te(()=>[fe("Home")]),_:1}),o("button",{onClick:g[0]||(g[0]=()=>s(i).setSettingsDisplayed()),class:"ml-3 i-mdi-cog"})])],32)}}}),de=Symbol();function Ee(f){const t=p(null),i=_(()=>t.value?t.value.getBoundingClientRect():{top:0,height:100,bottom:100}),n=[];let e=[];const a=be({}),g=_(()=>f.value==="none"||f.value==="continues"?250:1e3),b=Te(()=>{R()},100,{maxWait:g});Re(t,"scroll",b),ye(de,c=>{n.push(c),b()});function R(){e=[];for(const c of n){const r=V(c.elementRef.value);r!==c.isActive.value&&(c.isActive.value=r),r&&e.push(c)}D()}function V(c){const r=c.getBoundingClientRect();return r.top<i.value.bottom+i.value.height&&r.bottom>i.value.top}function x(c,{top:r=i.value.top,bottom:d=i.value.bottom}={}){const y=c.getBoundingClientRect();return Math.round(y.bottom)<=Math.round(d)&&Math.round(y.top)>=Math.round(r)}function w(c){const r=c.getBoundingClientRect();return r.top<i.value.bottom&&r.bottom>i.value.top}const M=c=>{var d;const r=c.contentRef.value;return r?((d=r.children[0])==null?void 0:d.children)??[]:[]};function D(){a.value={};let c=!0;for(const r of e){const d=w(r.elementRef.value),y={item:r,isFirstItem:c,isVisible:d};c=!1;const C=M(r);if(d&&C.length>0){const $=[],A=r.stickyRef.value,l=A==null?void 0:A.getBoundingClientRect().bottom;for(let m=0;m<C.length;m++){const S=C[m];x(S,{top:l})&&$.push(m)}y.subItemsVisible=$,y.subItemsLength=C.length}a.value[r.id]=y}}function B(){var c;for(const r of e){const d=a.value[r.id];if(!d)continue;const y=((c=d.subItemsVisible)==null?void 0:c.length)||0;if(!d.isFirstItem)return{item:r,isFirstItem:!1};if(y>=2){const C=M(r);return{item:r,currentSubItem:C[d.subItemsVisible[0]],nextSubItem:C[d.subItemsVisible[1]],isFirstItem:!0}}}return null}function L(){var c;for(const r of e){const d=a.value[r.id];if(!d)continue;if(!d.isVisible)return{item:r,isFirstItem:d.isFirstItem};const y=(c=d.subItemsVisible)==null?void 0:c.slice(-1)[0],C=y!==void 0;if(!C&&!d.isFirstItem)return{item:r,isFirstItem:d.isFirstItem};if(C&&y<d.subItemsLength-1)return{item:r,nextSubItem:M(r)[y+1],isFirstItem:d.isFirstItem}}return null}return{columnWrapper:t,columnWrapperRect:i,columnItems:n,getNextItemOnPage:B,getNextItemBelowPage:L,checkItemsVisibility:D}}function Dt(f){const t=ve(de);if(!t)throw new Error("registerScrollColumnItem not provided");const i=p(null),n=p(null),e=p(null),a=p(!1);return he(()=>{i.value&&t({id:f,elementRef:p(i.value),stickyRef:n,contentRef:e,isActive:a})}),{scrollItemRef:i,stickyRef:n,contentRef:e,isActive:a}}const me=ue("tableSizing",()=>{const f=p(50),t=p("single");return{lineHeight:_(()=>f.value*(t.value==="relay"?4:1)),mode:t}}),$e=j({__name:"ScrollColumn",setup(f){const t=W(),i=me(),n=p(null),{columnWrapper:e,columnWrapperRect:a,getNextItemOnPage:g,getNextItemBelowPage:b,checkItemsVisibility:k}=Ee(_e(t,"scrollType")),R=_(()=>a.value?Math.floor(a.value.height/i.lineHeight):0),V=_(()=>R.value*t.readLineTimeMS||1e3);let x=null,w={};const M={page:l,row:m,continues:S};ee(()=>t.scrollType,u=>{x&&(x(),x=null),u!=="none"&&(x=M[u]())},{immediate:!0});function D(){return n.value?c(n.value):!0}function B(){return n.value?a.value.top>=0:!0}function L(){var u;(u=e.value)==null||u.scrollTo({top:0,behavior:"smooth"})}function c(u){const I=s(u).getBoundingClientRect(),P=16,E=I.bottom-a.value.bottom;return Math.floor(E)<=P}function r(u){var I,P,E;const v=u();if(!v){k();return}if(v.nextSubItem){const z=v.nextSubItem.getBoundingClientRect(),H=((I=v.item.stickyRef.value)==null?void 0:I.offsetHeight)||0,N=z.top-a.value.top-H;(P=e.value)==null||P.scrollBy({top:N,behavior:"smooth"})}else{const H=v.item.elementRef.value.getBoundingClientRect().top-a.value.top;(E=e.value)==null||E.scrollBy({top:H,behavior:"smooth"})}}const C={page:()=>r(b),row:()=>r(g)};function $(u){B()&&k(),D()?L():u()}function A(u,v){const I=w[u]??De(()=>$(C[u]),v);return w[u]||(w[u]=I),I.isActive.value||I.resume(),I.pause}function l(){return A("page",V)}function m(){return A("row",()=>t.readLineTimeMS)}function S(){const u=p(!1),v=()=>u.value=!0;return U(u),v}function U(u){window.setTimeout(()=>{u.value||K(u)},V.value/2)}function K(u){if(e.value===null||n.value===null)return;const v=e.value.getBoundingClientRect(),I=n.value.getBoundingClientRect(),P=I.bottom-(v.height+v.top),E=Math.floor(P/i.lineHeight)*t.readLineTimeMS,z=v.top-I.top,H=P;let N=null,O;const oe=function(ne){var le;if(u.value){O&&window.cancelAnimationFrame(O);return}N||(N=ne);const se=ne-N,ge=Math.min(se/E,1);(le=e.value)==null||le.scrollTo(0,z+H*ge),se<E?O=window.requestAnimationFrame(oe):O&&(window.cancelAnimationFrame(O),window.setTimeout(()=>{u.value||(L(),U(u))},V.value))};O=window.requestAnimationFrame(oe)}return(u,v)=>(h(),T("div",{class:"flex-1 overflow-y-scroll columnWrapper",ref_key:"columnWrapper",ref:e},[o("div",{ref_key:"columnContent",ref:n},[xe(u.$slots,"default")],512)],512))}});function Oe(f){const{getCompetitionLoader:t}=Be(),{competition:i,status:n}=t(f),e=me(),a=_(()=>i.value?[...i.value.categories].sort((k,R)=>k.name.localeCompare(R.name)):[]),g=_(()=>{if(i.value)return{...i.value,categories:a.value}});return ee(()=>{var b;return(b=i.value)==null?void 0:b.isRelay},(b,k)=>{!b||b===k||(e.mode=b?"relay":"single")},{immediate:!0}),{competition:g,status:n}}const Ue={class:"font-mrb grow flex overflow-hidden pt-3"},He={key:1},Ne={key:2},je=j({__name:"CompetitionTable",props:{competitionId:null},setup(f){const t=f,i=re(()=>ie(()=>import("./CategoryTable-eef565ea.js"),["assets/CategoryTable-eef565ea.js","assets/dateTime-421cc72f.js","assets/useDataProvider-386edcea.js","assets/index-886848bc.js","assets/index-fc0f7264.css","assets/CategoryTable-1f843fc8.css"])),n=re(()=>ie(()=>import("./CategoryRelayTable-885e80ef.js"),["assets/CategoryRelayTable-885e80ef.js","assets/dateTime-421cc72f.js","assets/useDataProvider-386edcea.js","assets/index-886848bc.js","assets/index-fc0f7264.css","assets/CategoryRelayTable-47d3e90d.css"])),e=W(),{competitionId:a}=Ce(t),{competition:g,status:b}=Oe(a),k=_(()=>g.value?g.value.isRelay?n:i:null),R=_(()=>g.value?g.value.categories.reduce((x,w)=>(x[w.name]=w,x),{}):{}),V=_(()=>Object.keys(R.value));return ke(()=>e.setAvailableCategories(V.value)),(x,w)=>(h(),T(Y,null,[s(g)?(h(),J(Pe,{key:0,competition:s(g)},null,8,["competition"])):ce("",!0),o("div",Ue,[s(b)==="success"&&s(g)?(h(!0),T(Y,{key:0},Z(s(e).categoriesDisplayByColumn,(M,D)=>(h(),J($e,{key:"result-col-"+D,class:"px-1.5"},{default:te(()=>[(h(!0),T(Y,null,Z(M,B=>(h(),J(s(k),{key:B.name,competition:s(g),category:s(R)[B.name],class:"mb-4"},null,8,["competition","category"]))),128))]),_:2},1024))),128)):s(b)==="loading"?(h(),T("div",He,"Loading data")):(h(),T("div",Ne,"Error occured while loading data, try again later"))])],64))}}),We={class:"overflow-auto shadow-lg border-t-4 bg-white mb-4 rounded-l-lg rounded-t border-header w-full md:w-1/4"},ze={class:"px-6 py-4 mt-4 mb-8"},qe=o("h3",null,"Result table settings",-1),Je={class:"mb-6"},Ye=o("h4",null,"Column number",-1),Ge={class:"flex flex-col items-start mb-2"},Ke=o("label",{for:"scroll-columns-count",class:"hidden block mb-1 mr-2 text-sm font-medium text-gray-900 dark:text-white"},"Column number",-1),Qe=["value"],Xe=o("h4",null,"(Auto) Scrolling",-1),Ze={class:"flex items-center mb-2"},et=o("label",{for:"scroll-page",class:"ml-2 text-sm font-medium text-gray-900 dark:text-gray-300"},"Scroll by page",-1),tt={class:"flex items-center mb-2"},ot=o("label",{for:"scroll-row",class:"ml-2 text-sm font-medium text-gray-900 dark:text-gray-300"},"Scroll by row",-1),nt={class:"flex items-center mb-2"},st=o("label",{for:"scroll-continues",class:"ml-2 text-sm font-medium text-gray-900 dark:text-gray-300"},"Continues scroll",-1),lt={class:"flex items-center mb-2"},rt=o("label",{for:"scroll-none",class:"ml-2 text-sm font-medium text-gray-900 dark:text-gray-300"},"Manual scroll",-1),it=o("h4",null,"Scroll speed (time per result line)",-1),at={class:"flex items-center mb-2"},ut={for:"scroll-speed",class:"block mb-1 mr-2 text-sm font-medium text-gray-900 dark:text-white"},ct=o("h4",null,"Table content",-1),dt={class:"flex items-center mb-2"},mt=o("label",{for:"unfinished-checkbox",class:"ml-2 text-sm font-medium text-gray-900 dark:text-gray-300"},"Show unfinished (startlist, running)",-1),gt={class:"flex items-center mb-2"},ft=o("label",{for:"compact-checkbox",class:"ml-2 text-sm font-medium text-gray-900 dark:text-gray-300"},"Compact mode (no club, card)",-1),pt={class:"flex items-center mb-2"},bt=o("label",{for:"compact-checkbox",class:"ml-2 text-sm font-medium text-gray-900 dark:text-gray-300"},"Show Emojis in table",-1),yt=o("h5",null,"Displayed classes",-1),vt={class:"flex flex-col flex-wrap gap-y-2"},ht=["for"],_t=["id","checked","onChange"],xt=["value","onInput","max"],Ct=["disabled","onClick"],kt=["disabled","onClick"],wt=j({__name:"CompetitionSettings",setup(f){const t=W();return(i,n)=>(h(),T("div",We,[o("div",ze,[qe,o("form",null,[o("div",Je,[Ye,o("div",Ge,[Ke,o("input",{value:s(t).scrollColumnsCount,onInput:n[0]||(n[0]=e=>s(t).setScrollColumnsCount(parseInt(e.target.value))),id:"scroll-columns-count",type:"number",min:"1",max:"10",step:"1",class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"},null,40,Qe)]),Xe,o("div",Ze,[F(o("input",{"onUpdate:modelValue":n[1]||(n[1]=e=>s(t).scrollType=e),id:"scroll-page",type:"radio",value:"page",name:"scroll by page",class:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"},null,512),[[q,s(t).scrollType]]),et]),o("div",tt,[F(o("input",{"onUpdate:modelValue":n[2]||(n[2]=e=>s(t).scrollType=e),id:"scroll-row",type:"radio",value:"row",name:"scroll by row",class:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"},null,512),[[q,s(t).scrollType]]),ot]),o("div",nt,[F(o("input",{"onUpdate:modelValue":n[3]||(n[3]=e=>s(t).scrollType=e),id:"scroll-continues",type:"radio",value:"continues",name:"scroll continuesly",class:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"},null,512),[[q,s(t).scrollType]]),st]),o("div",lt,[F(o("input",{"onUpdate:modelValue":n[4]||(n[4]=e=>s(t).scrollType=e),id:"scroll-none",type:"radio",value:"none",name:"scroll manually",class:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"},null,512),[[q,s(t).scrollType]]),rt]),it,o("div",at,[o("label",ut,G(s(t).readLineTimeSeconds)+"s",1),F(o("input",{"onUpdate:modelValue":n[5]||(n[5]=e=>s(t).readLineTimeSeconds=e),id:"scroll-speed",type:"range",min:"0.1",max:"4",step:"0.1",class:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer dark:bg-gray-700"},null,512),[[we,s(t).readLineTimeSeconds]])]),ct,o("div",dt,[F(o("input",{id:"unfinished-checkbox",type:"checkbox","onUpdate:modelValue":n[6]||(n[6]=e=>s(t).showUnfinishedAthletes=e),class:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"},null,512),[[Q,s(t).showUnfinishedAthletes]]),mt]),o("div",gt,[F(o("input",{id:"compact-checkbox",type:"checkbox","onUpdate:modelValue":n[7]||(n[7]=e=>s(t).compactMode=e),class:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"},null,512),[[Q,s(t).compactMode]]),ft]),o("div",pt,[F(o("input",{id:"compact-checkbox",type:"checkbox","onUpdate:modelValue":n[8]||(n[8]=e=>s(t).showEmojis=e),class:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"},null,512),[[Q,s(t).showEmojis]]),bt]),yt,o("div",vt,[(h(!0),T(Y,null,Z(s(t).categoriesDisplay,e=>(h(),T("div",{key:e.name,class:"grid grid-cols-5 gap-2"},[o("label",{for:`show-category-${e.name}`,class:"ml-2 text-sm font-medium text-gray-900 dark:text-gray-300"},G(e.name),9,ht),o("input",{id:`show-category-${e.name}`,type:"checkbox",checked:e.selected,onChange:()=>s(t).setCategorySelected(e),class:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"},null,40,_t),o("input",{value:e.column,onInput:a=>s(t).setCategoryDisplayColumn(e,parseInt(a.target.value)),type:"number",min:"1",max:s(t).scrollColumnsCount,step:"1",class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-1"},null,40,xt),o("button",{disabled:e.order===0,onClick:ae(()=>s(t).setCategoryDisplayOrder(e,!0),["prevent"])}," Up ",8,Ct),o("button",{disabled:e.order===s(t).categoriesDisplay.length-1,onClick:ae(()=>s(t).setCategoryDisplayOrder(e,!1),["prevent"])}," Down ",8,kt)]))),128))])])])])]))}}),St={class:"w-screen h-screen overflow-hidden flex flex-col"},It=j({__name:"CompetitionView",setup(f){const t=Se(),i=_(()=>t.params.competitionId??"1"),n=_(()=>t.params.providerId),e=W();return(a,g)=>(h(),T("div",St,[X(Ve,{provider:s(n)},{default:te(()=>[X(je,{"competition-id":s(i)},null,8,["competition-id"])]),_:1},8,["provider"]),s(e).areSettingsDisplayed?(h(),J(wt,{key:0,class:"fixed inset-y-24 right-0 z-3"})):ce("",!0)]))}}),Bt=Object.freeze(Object.defineProperty({__proto__:null,default:It},Symbol.toStringTag,{value:"Module"}));export{Bt as C,Dt as a,W as u};
