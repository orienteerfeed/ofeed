import{d as T,f as N,a as v,_ as F}from"./dateTime-421cc72f.js";import{u as $,A as r,a as B}from"./useDataProvider-386edcea.js";import{d as x,c as m,o as n,a,u as s,t as l,b as y,h as p,a5 as E,g as D,l as C,F as R,f as S}from"./index-886848bc.js";import{u as M,a as O}from"./CompetitionView-605400e4.js";const U={key:0,class:"tabular-nums"},I={key:1},V={key:2},L={key:3},q={class:"text-ellipsis overflow-hidden whitespace-nowrap"},z={key:4},H={key:5},P={key:6,class:"text-right tabular-nums"},Y={key:7,class:"text-right"},G={key:8,class:"text-right tabular-nums"},J={key:9},A=x({__name:"CategoryTableFinishedRow",props:{data:null,isEven:{type:Boolean},isCompact:{type:Boolean},showEmojis:{type:Boolean}},setup(t){const e=t,{now:i}=$(),h=5*60,f=m(()=>e.data.updatedAt?T(i.value,e.data.updatedAt)<h:!1),u=m(()=>f.value?"bg-highlight":e.isEven?"bg-even":"bg-white"),c=m(()=>f.value?"text-white":"text-black"),g=m(()=>e.isCompact?"table-row-grid-compact":"table-row-grid"),o={[r.Ok]:"🏁",[r.NotCompeting]:"🚫",[r.Running]:"🏃",[r.DidNotFinish]:"😟",[r.Disqualified]:"🏴",[r.Mispunch]:"🙈",[r.OverMaxTime]:"⏰",[r.DidNotStart]:"🥺",[r.NotStarted]:"🚪"};return(d,_)=>(n(),a("div",{class:E([[s(u),s(c),s(g)],"grid gap-2 px-3 py-1.5 rounded-lg"])},[t.data.status===s(r).Ok?(n(),a("span",U,l(t.data.rank)+".",1)):t.data.status===s(r).NotCompeting?(n(),a("span",I,"MS")):t.showEmojis&&o[t.data.status]?(n(),a("span",V,l(o[t.data.status]),1)):(n(),a("span",L)),y("span",q,l(t.data.surname)+" "+l(t.data.firstName),1),t.isCompact?p("",!0):(n(),a("span",z,l(t.data.card),1)),t.isCompact?p("",!0):(n(),a("span",H,l(t.data.club),1)),t.data.status===s(r).Ok||t.data.status===s(r).NotCompeting?(n(),a("span",P,l(t.data.time),1)):(n(),a("span",Y,l(s(N)(t.data.status)),1)),t.data.loss?(n(),a("span",G,"+ "+l(t.data.loss),1)):(n(),a("span",J))],2))}});const K={key:0},Q={key:1},W={key:2},X={class:"text-ellipsis overflow-hidden whitespace-nowrap"},Z={key:3},tt={key:4},et={key:5,class:"text-right text-2xl italic tabular-nums"},st={key:6,class:"text-right tabular-nums"},nt={key:7},at={key:8,class:"text-right text-2xl"},it={key:9},ot=x({__name:"CategoryTableUnfinishedRow",props:{data:null,isEven:{type:Boolean},isVisible:{type:Boolean},isCompact:{type:Boolean},showEmojis:{type:Boolean}},setup(t){const e=t,i=e.isEven?"bg-even":"bg-white",{now:h,timeFormatter:f}=$(),u=m(()=>e.data.startTime?e.data.startTime<h.value:e.data.status===r.Running),c=m(()=>f.format(e.data.startTime)),g=m(()=>{if(!e.data.startTime||!u.value||!e.isVisible)return"";const d=T(h.value,e.data.startTime);return v(d)}),o=m(()=>e.isCompact?"table-row-grid-compact":"table-row-grid");return(d,_)=>(n(),a("div",{class:E([[s(i),s(o)],"grid table-row-grid gap-2 px-3 py-1.5 rounded-lg items-center"])},[e.showEmojis&&s(u)?(n(),a("span",K,"🏃")):e.showEmojis&&!s(u)?(n(),a("span",Q,"🛌🏻")):(n(),a("span",W)),y("span",X,l(t.data.surname)+" "+l(t.data.firstName),1),t.isCompact?p("",!0):(n(),a("span",Z,l(t.data.card),1)),t.isCompact?p("",!0):(n(),a("span",tt,l(t.data.club),1)),s(u)?(n(),a("span",et,l(s(g)),1)):s(u)?(n(),a("span",nt)):(n(),a("span",st,l(s(c)),1)),t.isCompact&&!s(u)&&t.data.card?(n(),a("span",at,l(t.data.card),1)):(n(),a("span",it))],2))}});function ct({competition:t,category:e,fetchEnabled:i}){const{getAthletesLoader:h}=B(),{rawAthletes:f,status:u}=h({category:e,competition:t,fetchEnabled:i}),c=m(()=>u.value!=="success"||!f.value?{finished:[],unfinished:[]}:f.value.reduce((o,d)=>(d.status===r.NotStarted||d.status===r.Running?o.unfinished.push(d):o.finished.push(d),o),{finished:[],unfinished:[]})),g=m(()=>c.value.finished.length>0||c.value.unfinished.length>0);return{status:u,athletes:c,areAvailable:g}}function rt(t){return m(()=>{if(!t.value.finished.length)return{firstRow:null,restRows:[]};const i=[...t.value.finished];return i.sort(lt),ut(i)})}function lt(t,e){return t.status!==e.status?t.status-e.status:t.timeSeconds!==e.timeSeconds?t.timeSeconds-e.timeSeconds:0}function ut(t){const e=t[0];if(e.status!==r.Ok)return{firstRow:null,restRows:t};const i={...e,rank:1,time:v(e.timeSeconds),loss:""};let h=i.time,f=i.rank;const u=t.slice(1).map((c,g)=>{if(c.status===r.Ok){const o=v(c.timeSeconds);return h===o||(f=g+2,h=o),{...c,rank:f,time:o,loss:dt(i,c)}}if(c.status===r.NotCompeting){const o=v(c.timeSeconds);return{...c,time:o}}return c});return{firstRow:i,restRows:u}}function dt(t,e){const i=e.timeSeconds-t.timeSeconds;return i===0?"":v(i)}function mt(t){return m(()=>{if(!t.value.unfinished.length)return[];const i=[...t.value.unfinished];return i.sort(ht),i})}function ht(t,e){return t.startTime&&e.startTime?t.startTime>e.startTime?1:-1:t.status!==e.status?t.status-e.status:t.surname<e.surname?-1:1}const ft={key:0,class:"w-full text-3xl font-bold bg-white"},gt={key:0,class:"w-full text-3xl font-bold bg-white"},pt={key:0,class:"bg-gray-300 h-100 grid gap-4 place-content-center place-items-center"},yt=y("span",{class:"relative flex h-3 w-3"},[y("span",{class:"animate-ping absolute inline-flex h-full w-full rounded-full bg-sky-400 opacity-75"}),y("span",{class:"relative inline-flex rounded-full h-3 w-3 bg-sky-500"})],-1),vt=y("span",{class:"text-2xl font-bold animate-pulse"},"Loading data",-1),wt=[yt,vt],St=x({__name:"CategoryTable",props:{competition:null,category:null},setup(t){const e=t,i=M(),{scrollItemRef:h,stickyRef:f,contentRef:u,isActive:c}=O(e.category.name),{status:g,athletes:o,areAvailable:d}=ct({competition:e.competition,category:e.category,fetchEnabled:c}),_=m(()=>({finished:o.value.finished.length,unfinished:o.value.unfinished.length,full:o.value.finished.length+o.value.unfinished.length})),b=rt(o),j=mt(o);return(kt,_t)=>(n(),a("div",{ref_key:"scrollItemRef",ref:h},[y("div",{class:"sticky top-0",ref_key:"stickyRef",ref:f},[D(F,{class:"p-3",category:e.category,"athletes-count":s(_)},null,8,["category","athletes-count"]),s(g)==="success"&&s(d)?(n(),a("div",ft,[s(b).firstRow?(n(),C(A,{key:0,data:s(b).firstRow,"is-even":!1,"is-compact":s(i).compactMode,"show-emojis":s(i).showEmojis,class:"border-b-2 border-gray-600 border-dashed"},null,8,["data","is-compact","show-emojis"])):p("",!0)])):p("",!0)],512),y("div",{ref_key:"contentRef",ref:u},[s(g)==="success"&&s(d)?(n(),a("div",gt,[(n(!0),a(R,null,S(s(b).restRows,(w,k)=>(n(),C(A,{data:w,key:w.rank,"is-even":k%2===0,"is-compact":s(i).compactMode,"show-emojis":s(i).showEmojis},null,8,["data","is-even","is-compact","show-emojis"]))),128)),s(i).showUnfinishedAthletes?(n(!0),a(R,{key:0},S(s(j),(w,k)=>(n(),C(ot,{data:w,key:k,"is-even":k%2===0,"is-visible":s(c),"is-compact":s(i).compactMode,"show-emojis":s(i).showEmojis},null,8,["data","is-even","is-visible","is-compact","show-emojis"]))),128)):p("",!0)])):p("",!0)],512),s(g)==="success"&&s(d)?p("",!0):(n(),a("div",pt,wt))],512))}});export{St as default};
